# ──────────────────────────────────────────────────────────────
# mimic.toml — declarative dotfile management for ~/.dots
# ──────────────────────────────────────────────────────────────

[variables]
name  = "Brayden Moon"
email = "brayden@binbandit.dev"
git_name  = "BinBandit"
git_email = "crazywolf132@gmail.com"
editor = "nvim"
shell  = "fish"

# Shared environment defaults
openai_model      = "gpt-5-nano"
openai_url        = "https://api.openai.com/v1/"
openai_timeout    = "4096"
openai_max_tokens = "272000"

# Host-overrideable defaults (every host should override these)
codex_model       = "gpt-5-codex"
extra_fish_paths  = ""
proxy_http        = ""
proxy_https       = ""
cert_bundle       = ""

# Python / uv
uv_python_version = "3.12"

# ──────────────────────────────────────────────────────────────
# Dotfiles — static symlinks
# ──────────────────────────────────────────────────────────────

# XDG config directories
[[dotfiles]]
source = "dotfiles/config/ghostty"
target = "~/.config/ghostty"

[[dotfiles]]
source = "dotfiles/config/opencode/commands"
target = "~/.config/opencode/commands"

[[dotfiles]]
source = "dotfiles/config/helix"
target = "~/.config/helix"

[[dotfiles]]
source = "dotfiles/config/nvim"
target = "~/.config/nvim"

[[dotfiles]]
source = "dotfiles/config/tmux"
target = "~/.config/tmux"

[[dotfiles]]
source = "dotfiles/config/zed"
target = "~/.config/zed"

[[dotfiles]]
source = "dotfiles/config/git/ignore"
target = "~/.config/git/ignore"

[[dotfiles]]
source = "templates/git/local.conf.hbs"
target = "~/.config/git/local.conf"

# Fish — static pieces (functions, completions)
[[dotfiles]]
source = "dotfiles/config/fish/functions"
target = "~/.config/fish/functions"

[[dotfiles]]
source = "dotfiles/config/fish/completions"
target = "~/.config/fish/completions"

[[dotfiles]]
source = "dotfiles/config/fish/config.fish"
target = "~/.config/fish/config.fish"

# Fish — conf.d (template first to ensure parent dir is created on fresh machines)
[[dotfiles]]
source = "templates/fish/10-host.fish.hbs"
target = "~/.config/fish/conf.d/10-host.fish"

[[dotfiles]]
source = "templates/fish/00-init.fish"
target = "~/.config/fish/conf.d/00-init.fish"

# Only abbreviations go here; fzf.fish and pisces.fish are managed by Fisher
[[dotfiles]]
source = "dotfiles/config/fish/conf.d/10-abbr.fish"
target = "~/.config/fish/conf.d/10-abbr.fish"

[[dotfiles]]
source = "templates/fish/fish_plugins"
target = "~/.config/fish/fish_plugins"

[[dotfiles]]
source = "templates/fish/keychain-secrets.fish.hbs"
target = "~/.config/fish/keychain-secrets.fish"

# mise — generated
[[dotfiles]]
source = "templates/mise/config.toml"
target = "~/.config/mise/config.toml"

# Codex — generated per-host
[[dotfiles]]
source = "templates/codex/config.toml.hbs"
target = "~/.codex/config.toml"

# Home directory dotfiles
[[dotfiles]]
source = "dotfiles/gitconfig"
target = "~/.gitconfig"

[[dotfiles]]
source = "dotfiles/claude/commands"
target = "~/.claude/commands"

# ──────────────────────────────────────────────────────────────
# Packages — Homebrew
# ──────────────────────────────────────────────────────────────

[packages]
brew = [
  # Shell & TUI
  "fish",
  "tmux",
  "fzf",
  "ripgrep",
  "fd",
  "bat",
  "starship",
  "zoxide",
  "direnv",
  "sesh",
  "lazygit",
  "jq",
  "eza",
  "git-delta",
  "fswatch",

  # Languages & runtimes
  "node",
  "pnpm",
  "python@3.12",
  "go",
  "rustup-init",
  "uv",
  "mise",

  # AI
  "anomalyco/tap/opencode",

  # System
  "openssl@3",
  "gnu-sed",
  "coreutils",
]

# ──────────────────────────────────────────────────────────────
# Hooks — activation tasks (run after dotfiles + packages)
# ──────────────────────────────────────────────────────────────

# Install mise-declared runtimes
[[hooks]]
type = "mise"

# Python via uv with symlinks into ~/.local/bin
[[hooks]]
type = "uv-python"
version = "3.12"

[hooks.symlinks]
python  = "~/.local/bin/python"
python3 = "~/.local/bin/python3"

# Rust toolchains, components, and cross-compile targets
[[hooks]]
type = "rustup"
toolchains = ["stable", "nightly"]
components = ["rustfmt", "clippy", "rust-analyzer", "rust-src", "rust-docs"]
targets    = ["x86_64-unknown-linux-musl"]
default    = "nightly"

# Cargo tools from git
[[hooks]]
type = "cargo-install"

[[hooks.packages]]
name = "tap"
git  = "https://github.com/crazywolf132/tap.git"

[[hooks.packages]]
name = "sg"
git  = "https://github.com/sage-scm/sage.git"
bin  = "sg"

[[hooks.packages]]
name = "keychainctl"
git  = "https://github.com/binbandit/keychainctl.git"

# Set fish as default shell
[[hooks]]
type       = "command"
name       = "fish-default-shell"
command    = "FISH=$(command -v fish) && grep -qF \"$FISH\" /etc/shells 2>/dev/null || echo \"$FISH\" | sudo tee -a /etc/shells >/dev/null; [ \"$SHELL\" != \"$FISH\" ] && chsh -s \"$FISH\" || true"
on_failure = "continue"

# Install Claude Code
[[hooks]]
type       = "command"
name       = "claude-code"
command    = "command -v claude >/dev/null 2>&1 || curl -fsSL https://claude.ai/install.sh | bash"
on_failure = "continue"

# Install Fisher + plugins
[[hooks]]
type       = "command"
name       = "fisher-plugins"
command    = "FISH=$(command -v fish) && $FISH -c 'type -q fisher; or begin; curl -sL https://raw.githubusercontent.com/jorgebucaran/fisher/main/functions/fisher.fish | source; and fisher install jorgebucaran/fisher; end' && $FISH -c 'fisher update'"
on_failure = "continue"

# ──────────────────────────────────────────────────────────────
# Hosts — machine-specific overrides
# ──────────────────────────────────────────────────────────────

[hosts.Braydens-MacBook-Pro]
roles = ["personal", "mac"]

[hosts.Braydens-MacBook-Pro.variables]
extra_fish_paths = "$HOME/.mitm_toolkit/bin"
codex_model     = "gpt-5-codex"
proxy_http      = ""
proxy_https     = ""
cert_bundle     = ""
git_name        = "BinBandit"
git_email       = "crazywolf132@gmail.com"

[hosts.EPZ-D3YJQFV0WJ]
roles = ["work", "mac"]

[hosts.EPZ-D3YJQFV0WJ.variables]
extra_fish_paths = ""
codex_model     = "aipe-gpt-5_v2025-08-07_EASTUS2"
proxy_http      = "http://localhost:3128"
proxy_https     = "http://localhost:3128"
cert_bundle     = "/Users/Shared/ca_certs/bundle.pem"
git_name        = "brayden-moon_cba"
git_email       = "brayden.moon@cba.com.au"
