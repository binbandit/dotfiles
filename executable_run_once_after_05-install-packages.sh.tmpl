#!/usr/bin/env bash
set -euo pipefail

OLD_BREWFILE="$HOME/Brewfile"
if [ -f "$OLD_BREWFILE" ]; then
  rm -f "$OLD_BREWFILE"
fi

case "$(uname -s)" in
  Darwin)
    if command -v brew >/dev/null 2>&1 && [[ -f "$HOME/.config/homebrew/Brewfile" ]]; then
      brew bundle --file "$HOME/.config/homebrew/Brewfile"
    fi
    ;;
  Linux)
    if command -v pacman >/dev/null 2>&1 && [[ -f "$HOME/packages-arch.txt" ]]; then
      sudo pacman -Syu --noconfirm
      sudo pacman -S --needed --noconfirm $(tr '\n' ' ' < "$HOME/packages-arch.txt")
    fi
    ;;
esac

# Remove this script after it runs to avoid clutter in $HOME.
rm -- "$0" >/dev/null 2>&1 || true
